---
title: "Single Site Data Availability"
output: 
  rmarkdown::html_vignette
editor_options: 
  chunk_output_type: console
vignette: >
  %\VignetteIndexEntry{Single Site Data Availability}
  \usepackage[utf8]{inputenc}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(echo = TRUE,
               warning = FALSE,
               message = FALSE,
               fig.width = 7,
               fig.height = 7)
library(dplyr)
library(tidyr)
library(ggplot2)
library(HASP)

options(knitr.kable.NA = '')
```


This vignette shows how to use `HASP` and other R tools to reproduce:

https://fl.water.usgs.gov/mapper/site_info.php?site=263819081585801&stationType=gw

This page merges information from USGS Groundwater Watch website and USGS Water Science Centers.

First, use the `dataRetrieval` package to get site information:

## DESCRIPTION

```{r siteInfo, results='asis'}
library(dataRetrieval)
library(HASP)
library(dplyr)
library(tidyr)

siteID <- "263819081585801"
site_metadata <- site_summary(siteID, markdown = TRUE)
```

## AVAILABLE DATA

```{r whatData}
data_info <- data_available(siteID)
kable(data_info)
```

## Site Statistics


## Groundwater Data

### Frequency

```{r monthlyFrequencyPlot}
gwl_data <- L2701_example_data$Discrete
title <- attr(gwl_data, "siteInfo")[["station_nm"]]
monthly_frequency_plot(gwl_data, plot_title = title, plot_range = "Past year")
```

```{r monthlyFrequencyTable}
gwl_data <- L2701_example_data$Discrete
monthly_freq_table <- monthly_frequency_table(gwl_data) %>%
  select(month, minMed, p10, p25, p50, p75, p90, maxMed, nYears) %>%
  mutate(month = month.abb[month]) %>%
  rename("Month" = month,
         "Lowest median" = minMed,
         "10th percentile" = p10,
         "25th percentile" = p25,
         "50th percentile" = p50,
         "75th percentile" = p75,
         "Highest median" = maxMed,
         "Number of years" = nYears)
kable(monthly_freq_table)
```

## Daily 2 year plot

```{r dailyPlot}
gwl_daily <- L2701_example_data$Daily
parameterCd <- "62610"
statCd <- "00001"
title <- attr(gwl_daily, "siteInfo")[["station_nm"]]
daily_gwl_2yr_plot(gwl_daily, parameterCd, statCd, 
                   plot_title = title, month_breaks = FALSE, historical_stat = "median")
```

```{r dailySummary}
gwl_daily <- L2701_example_data$Daily
parameterCd <- "62610"
statCd <- "00001"
daily_summary_table <- daily_gwl_summary(gwl_daily, parameterCd, statCd) %>%
  rename("Begin Date" = begin_date,
         "End Date" = end_date,
         "Days" = days,
         "% Complete" = percent_complete,
         "Lowest Level" = lowest_level,
         "5th %ile" = p5,
         "10th %ile" = p10,
         "25th %ile" = p25,
         "50th %ile" = p50,
         "75th %ile" = p75,
         "90th %ile" = p90,
         "95th %ile" = p95,
         "Highest Level" = highest_level)
kable(daily_summary_table)
```

## Periodic Groundwater Data

```{r periodicPlot}
# Get data:
# gwl_data <- dataRetrieval::readNWISgwl(siteID)
# Use package sample data:
gwl_data <- L2701_example_data$Discrete
title <- attr(gwl_data, "siteInfo")[["station_nm"]]
gwl_plot_periodic(gwl_data, title)
```

### Period of Record - All Data Types

```{r dvPlot}
# Get data:
parameterCd <- "62610"
statCd <- "00001"
# dv <- dataRetrieval::readNWISdv(siteID, 
#                                 parameterCd, 
#                                 statCd = statCd)
# Use package sample data:
dv <- L2701_example_data$Daily

gwl_plot_all(dv, gwl_data, title)
```


## Salinity Data and Analysis

```{r get_qw_data}
# Get data:
# parameterCd <- c("00095","90095","00940","99220")
# site_data <- readNWISqw(siteID,  parameterCd)

# Use package sample data:
qw_data <- L2701_example_data$QW

```

### Chloride

```{r chloride_plot}
trend_plot(qw_data, plot_title = title)
```

```{r chloride_trend}
cl_trend <- kendell_test_5_20_years(qw_data, 
                     seasonal = FALSE,
                     enough_5 = 1,
                     enough_20 = 1,
                     date_col = "sample_dt",
                     value_col = "result_va")
kable(cl_trend, digits = 3)
```

```{r chloride_table}
chl_table <- qw_summary(qw_data, 
                       pcode = c("00940","99220"),
                       norm_range = c(225,999))
kable(chl_table)

```


### Specific Conductance

```{r qwplot1}
qw_plot(qw_data, "Specific Conductance", 
        pcode = c("00095", "90095"))

```

```{r sc_table}
sc_table <- qw_summary(qw_data, 
                       pcode = c("00095","90095"),
                       norm_range = NA)
kable(sc_table)

```

### Specific Conductance vs Chloride

```{r salityPlot}

Sc_Cl_plot(qw_data, plot_title = title)

```

```{r salityTable, echo=TRUE}
sc_cl <- Sc_Cl_table(qw_data)

# only show 10 row:
kable(head(sc_cl, 10), 
      col.names = c("Date",
                    "Chloride [mg/L]",
                    "Specific conductance [ÂµS/L]"))
```

